{% extends "top.html" %}
{% block content %}
    <div class='container' style='padding: 0px;'>
        <div class='row'>
            <h1>AWS Server Health</h1>
            <a class="nav-link" href="{{ pagename }}">
                <img src="{{ url_for('static', filename='css/svg/si-glyph-arrow-circle-rycycle.svg') }}" class='refresh nav-icons' title='refresh data'>
            </a>
        </div>
            <div class='row'>
                {% for server, graph in data %}
                    <div class='col-md-6' style='margin:3px 0px'>
                        <div class="card" style='padding: 20px;'>
                            <div class="card-block">
                                <h4 class="card-title">{{ server['InstanceName'] }}</h4>
                                <h6 class="card-subtitle mb-2 text-muted">
                                    {{ server['Label'] }}
                                </h6>
                                <small>
                                    {{ graph[-1][0] }}
                                </small>
                                <p class="card-text">
                                    {% if server['Datapoints'][0]['Average'] > 80 %}
                                        <div class="alert alert-danger" role="alert">
                                           Avg. {{ server['Datapoints'][0]['Average']|round(2) }}%
                                        </div>
                                    {% elif server['Datapoints'][0]['Average'] > 50 %}
                                        <div class="alert alert-warning" role="alert">
                                            Avg. {{ server['Datapoints'][0]['Average']|round(2) }}%
                                        </div>
                                    {% elif server['Datapoints'][0]['Average'] > 20 %}
                                        <div class="alert alert-info" role="alert">
                                            Avg. {{ server['Datapoints'][0]['Average']|round(2) }}%
                                        </div>
                                    {% else %}
                                        <div class="alert alert-success" role="alert">
                                            Avg. {{ server['Datapoints'][0]['Average']|round(2) }}%
                                        </div>
                                    {% endif %}
                                </p>
                                <canvas id="graph_{{ server['InstanceName'] }}"></canvas>
                            </div>
                        </div>
                    </div>
                    <script>
                        var ctx = document.getElementById("graph_{{ server['InstanceName'] }}");
                        var labels = [{% for date in graph %}
                              "{{date[0]}}",
                              {% endfor %}];
                        var values = [{% for value in graph %}
                                    {{value[1]}},
                                    {% endfor %}];
                        console.log(labels, values);
                        new Chart(ctx, {
                            type: 'line',
                            data: {
                              labels: labels,
                              datasets: [
                                {
                                    label: '{{ server['Label'] }}',
                                    data: values,
                                    borderColor: "#3e95cd",
                                }
                              ]
                            }
                        });
                    </script>
                {% endfor %}
            </div>
    </div>
{% endblock %}